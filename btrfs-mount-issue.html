<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Btrfs mount issue
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>

    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
        <li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2025 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/btrfs-mount-issue.html" rel="bookmark"><h1>Btrfs mount issue</h1></a>
<div><p>takes 0 minutes to read</p></div>                        <time class="post-time" datetime="2015-09-07T19:00:00+02:00" pubdate>
                            last modified at Mon 07 September 2015
                        </time>
                    </header>
                    <section class="post-content">
                        <p>I decided to bootstrap my new machine with btrfs as filesystem instead of ext4 LVM volumes. By following the excellent arch-wiki <a href="https://wiki.archlinux.org/index.php/Btrfs">btrfs page</a> I successfully crafted a base system with sub volumes, limited on size and snapshots enabled.</p>
<p>Everything went fine, installed all the other stuff I needed, pulled in my data and was ready to go.</p>
<p>Obviously on that very moment disaster happened.. Due to an unexpected interrupt the journal went corrupt. When trying to boot I got stuck right after decrypted the disk failing to mount my btrfs root volume.</p>
<p>Uncool, unpleasant, .. I almost got insane..</p>
<p>So back to the live usb arch Linux, decrypted my disk:</p>
<div class="highlight"><pre><span></span><code># cryptsetup luksOpen /dev/sda2
</code></pre></div>

<p>and tried to manually mount the root volume</p>
<div class="highlight"><pre><span></span><code># mount /dev/mapper/root /mnt
</code></pre></div>

<p>which resulted in some error like:</p>
<div class="highlight"><pre><span></span><code>parent transid verify failed on 109973766144 wanted 1823 found 1821
parent transid verify failed on 13891821568 wanted 540620 found 541176
parent transid verify failed on 13891821568 wanted 540620 found 541176
parent transid verify failed on 13891821568 wanted 540620 found 541176
parent transid verify failed on 13891821568 wanted 540620 found 541176
btrfs: open_ctree failed
</code></pre></div>

<p>Crawling through so many forum posts, stack overflow, blogposts a lot of solutions were suggested but none of them resulted in successfully mounting my brand new system..</p>
<p>After some time I could mount the filesystem in <a href="http://ram.kossboss.com/btrfs-restore-curropt-system/">recovery mode</a></p>
<div class="highlight"><pre><span></span><code># mkdir -p /mnt/root
# mount -o ro,recover /dev/mapper/root /mnt/root
</code></pre></div>

<p>So I decided to copy over all this data to an USB disk using rsync:</p>
<div class="highlight"><pre><span></span><code># mkdir -p /mnt/disk
# mount /dev/sdb1 /mnt/disk
# rsync -ah --progress /mnt/root /mnt/disk
</code></pre></div>

<p>Off course this took some time.. Once the data was copied over I followed the steps described by <a href="http://ram.kossboss.com/btrfs-transid-issue-explained-fix/">kossboss</a>:</p>
<div class="highlight"><pre><span></span><code># btrfs-zero-log /dev/mapper/root
# btrfsck --init-csum-tree /dev/mapper/root
# btrfsck --fix-crc /dev/mapper/root
# btrfsck --repair /dev/mapper/root
</code></pre></div>

<p>But no luck at all unfortunately</p>
<p>So I went online to the <a href="http://irc.lc/freenode/btrfs/">irc #btrfs</a> channel and explained my issue. A user named darkling reached out a hand and really made my day by suggesting to mount the filesystem as <a href="https://btrfs.wiki.kernel.org/index.php/Mount_options#Recovery">recovery</a> without the ro option.</p>
<div class="highlight"><pre><span></span><code># mount -orecovery /dev/mapper/root /mnt/root
</code></pre></div>

<p>And hell yeah I finally got it mounted, this recovery option did wrote a new working tree when I unmounted the filesystem so I could mount it in a normal way again!</p>
<div class="highlight"><pre><span></span><code># umount /mnt/root
# mount /dev/mapper/root /mnt/root
</code></pre></div>

<p>So I rebooted my system from live cd to hard drive and got my system back up and running!</p>
<p>Darkling really was my hero of the day!</p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/btrfs.html">btrfs</a>, <a href="https://visibilityspots.github.io/blog/tag/mount.html">mount</a>, <a href="https://visibilityspots.github.io/blog/tag/issue.html">issue</a>, <a href="https://visibilityspots.github.io/blog/tag/error.html">error</a>, <a href="https://visibilityspots.github.io/blog/tag/transid.html">transid</a>, <a href="https://visibilityspots.github.io/blog/tag/restore.html">restore</a>, <a href="https://visibilityspots.github.io/blog/tag/recover.html">recover</a>, <a href="https://visibilityspots.github.io/blog/tag/open_ctree.html">open_ctree</a>, <a href="https://visibilityspots.github.io/blog/tag/failed.html">failed</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
    </body>
</html>