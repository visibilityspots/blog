<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Docker openstackclient-kilo container
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">
	<link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/tipuesearch/tipuesearch.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>
    <form id="searchform" action="https://visibilityspots.github.io/blog/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
	        <input id="searchbox" type="text" name="q" size="12" placeholder="search">
    </form>
    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/links.html">Links</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
	<li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2021 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/docker-openstackclient-kilo.html" rel="bookmark"><h1>Docker openstackclient-kilo container</h1></a>
<div><p>takes 2 minutes to read</p></div>                        <time class="post-time" datetime="2017-05-29T21:00:00+02:00" pubdate>
                            last modified at Wed 23 August 2017
                        </time>
                    </header>
                    <section class="post-content">
                        <p>A couple of years ago I deployed an openstack cluster based on <a href="https://www.rdoproject.org/">RDO</a>. Back in the days we implemented the <a href="https://www.openstack.org/software/kilo/">kilo</a> release. Until today we didn't updated yet due to various reasons being no need for the new features, no resources, no time no.. Upgrading would be a better option but we'll have to live with it and since it's running rather well so far we are quite happy with it.</p>
<p>To manage that cloud I use the clients I installed on my local machine, from nova to cinder they all have different packages available for many different platforms. Only a couple of weeks ago I noticed the new shiny versions shipping with <a href="https://www.archlinux.org/">Archlinux</a> aren't working anymore with our setup.</p>
<p>So I looked for alternatives, in the short term I logged in on one of the compute nodes or our <a href="https://jenkins.io/">jenkins</a> machine to perform the actions I needed to do. But that's bad practice. So I went a bit further and decided to create a docker container for this. Looking on the docker hub there are already some containers available but they don't specify a specific version.</p>
<p>Also this seemed to me like a great exercise to experience the different stages how a docker container could be built up completely by myself. So I went for it and created a <a href="https://github.com/visibilityspots/dockerfile-openstackclient-kilo">github repository</a> to share my work with the world.</p>
<h2>docker build</h2>
<p>The whole setup relies on one <a href="https://github.com/visibilityspots/dockerfile-openstackclient-kilo/blob/master/Dockerfile">Dockerfile</a>. Since I rely on centos in almost every server environment I'm working on I decided to use the centos:7 <a href="https://hub.docker.com/_/centos/">official</a> docker image.</p>
<p>After some try and error I came to this setup:</p>
<div class="highlight"><pre><span></span><code>FROM centos:7
RUN set -x \
    &amp;&amp; yum upgrade -y \
        &amp;&amp; yum install -y bash-completion \
    &amp;&amp; yum install -y https://repos.fedorapeople.org/repos/openstack/EOL/openstack-kilo/rdo-release-kilo-2.noarch.rpm \
    &amp;&amp; yum install -y python-novaclient \
    &amp;&amp; yum install -y python-ceilometerclient \
    &amp;&amp; yum install -y python-cinderclient \
    &amp;&amp; yum install -y python-glanceclient \
    &amp;&amp; yum install -y python-heatclient \
    &amp;&amp; yum install -y python-ironicclient \
    &amp;&amp; yum install -y python-keystoneclient \
    &amp;&amp; yum install -y python-manilaclient \
    &amp;&amp; yum install -y python-novaclient \
    &amp;&amp; yum install -y python-openstackclient \
    &amp;&amp; yum install -y python-saharaclient \
    &amp;&amp; yum install -y python-troveclient \
    &amp;&amp; yum install -y python-zaqarclient \
    &amp;&amp; yum clean all \
    &amp;&amp; useradd client

USER client

ENTRYPOINT [&quot;bash&quot;, &quot;--rcfile&quot;, &quot;/home/client/.keystonerc&quot;]
</code></pre></div>

<p>as you could see I opted to install every package using a separate yum install command. That way when a package can't be installed the others aren't infected. Also a yum clean all is performed to cleanup a bit the filesystem to keep the image size a bit under control. By adding a 'client' user I could prevent doing everything as root user which isn't really necessary in our case.</p>
<p>To use the openstack clients, openstack provides a keystonerc file you'll have to source before you could connect through the different API endpoints. I went for the ENTRYPOINT solution which will source a file which can be mounted at run time of the docker container afterwards.</p>
<p>I have to credit my colleague <a href="https://roidelapluie.be/">roidelapluie</a> here since he guided me to this Dockerfile. To be honest about every option :), but hey I learned a lot about the docker world this way!</p>
<p>So right now everyone should be able to build this container himself by checking out the repository and run the docker build command:</p>
<div class="highlight"><pre><span></span><code>$ git clone git@github.com:visibilityspots/dockerfile-openstackclient-kilo.git
$ docker build -t openstackclient-kilo .
</code></pre></div>

<p>If everything went well the new created docker image should be available on your machine:</p>
<div class="highlight"><pre><span></span><code>$ docker images
REPOSITORY                                          TAG                 IMAGE ID            CREATED              SIZE
openstackclient-kilo                                latest              e89297f75fa8        About a minute ago   331MB
</code></pre></div>

<h2>docker run</h2>
<p>So you could now use the image to spin up an openstack kilo client container:</p>
<div class="highlight"><pre><span></span><code>$ docker run --name openstack-client --rm -ti visibilityspots/openstackclient-kilo
bash-4.2$
</code></pre></div>

<p>As already described before the docker container will automatically source a keystonerc file at the /home/client/.keystonerc path. So you could mount a file from your local machine into the docker container at runtime:</p>
<div class="highlight"><pre><span></span><code>$ docker run --name openstack-client --rm -ti -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/keystonerc_admin:/home/client/.keystonerc visibilityspots/openstackclient-kilo
<span class="o">[</span>client@a1c38f7635e3 /<span class="o">(</span>keystone_admin<span class="o">)]</span>$ openstack hypervisor list
+----+---------------------+
<span class="p">|</span> ID <span class="p">|</span> Hypervisor Hostname <span class="p">|</span>
+----+---------------------+
<span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> node-01             <span class="p">|</span>
<span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> node-02             <span class="p">|</span>
<span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> node-03             <span class="p">|</span>
+----+---------------------+
</code></pre></div>

<h2>dgoss (testing)</h2>
<p>Some weeks ago I discovered the docker image testing tool <a href="https://github.com/aelsabbahy/goss/tree/master/extras/dgoss">dgoss</a> which is comparable with <a href="http://serverspec.org/">serverspec</a> to write tests in an easy yaml format to be performed against your docker image.</p>
<p>So I decided to give it a try and wrote a <a href="https://github.com/visibilityspots/dockerfile-openstackclient-kilo/blob/master/goss.yaml">goss.yaml</a> file;</p>
<div class="highlight"><pre><span></span><code><span class="kd">package</span><span class="o">:</span>
  <span class="n">rdo</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">kilo</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">novaclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">ceilometerclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">cinderclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">glanceclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">heatclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">ironicclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">keystoneclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">manilaclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">novaclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">openstackclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">saharaclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">troveclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>
  <span class="n">python</span><span class="o">-</span><span class="n">zaqarclient</span><span class="o">:</span>
    <span class="n">installed</span><span class="o">:</span> <span class="kc">true</span>

<span class="n">file</span><span class="o">:</span>
  <span class="sr">/home/client/</span><span class="o">:</span>
    <span class="n">exists</span><span class="o">:</span> <span class="kc">true</span>

<span class="n">command</span><span class="o">:</span>
  <span class="n">openstack</span> <span class="o">--</span><span class="n">version</span><span class="o">:</span>
    <span class="n">exit</span><span class="o">-</span><span class="n">status</span><span class="o">:</span> <span class="mi">0</span>
</code></pre></div>

<p>which will check if all packages are installed correctly and if the commands are working as they should;</p>
<div class="highlight"><pre><span></span><code><span class="err">$</span><span class="w"> </span><span class="n">dgoss</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">name</span><span class="w"> </span><span class="n">openstack</span><span class="o">-</span><span class="n">client</span><span class="w"> </span><span class="o">--</span><span class="n">rm</span><span class="w"> </span><span class="o">-</span><span class="n">ti</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="n">pwd</span><span class="p">)</span><span class="o">/</span><span class="nl">keystonerc_admin</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="p">.</span><span class="n">keystonerc</span><span class="w"> </span><span class="n">visibilityspots</span><span class="o">/</span><span class="n">openstackclient</span><span class="o">-</span><span class="n">kilo</span><span class="w"></span>
<span class="nl">INFO</span><span class="p">:</span><span class="w"> </span><span class="n">Starting</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">container</span><span class="w"></span>
<span class="nl">INFO</span><span class="p">:</span><span class="w"> </span><span class="n">Container</span><span class="w"> </span><span class="nl">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">539</span><span class="n">f6896</span><span class="w"></span>
<span class="nl">INFO</span><span class="p">:</span><span class="w"> </span><span class="n">Sleeping</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mf">0.2</span><span class="w"></span>
<span class="nl">INFO</span><span class="p">:</span><span class="w"> </span><span class="n">Running</span><span class="w"> </span><span class="n">Tests</span><span class="w"></span>
<span class="k">File</span><span class="err">:</span><span class="w"> </span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">client</span><span class="o">/</span><span class="p">.</span><span class="nl">keystonerc</span><span class="p">:</span><span class="w"> </span><span class="ow">exists</span><span class="err">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">cinderclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">ironicclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">manilaclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">rdo</span><span class="o">-</span><span class="k">release</span><span class="o">-</span><span class="n">kilo</span><span class="o">-</span><span class="mi">2</span><span class="err">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">novaclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">saharaclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">zaqarclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">glanceclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">troveclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">heatclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">keystoneclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">ceilometerclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">python</span><span class="o">-</span><span class="nl">openstackclient</span><span class="p">:</span><span class="w"> </span><span class="nl">installed</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">true</span><span class="o">]</span><span class="w"></span>
<span class="nl">Command</span><span class="p">:</span><span class="w"> </span><span class="n">openstack</span><span class="w"> </span><span class="o">--</span><span class="nl">version</span><span class="p">:</span><span class="w"> </span><span class="k">exit</span><span class="o">-</span><span class="nl">status</span><span class="p">:</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="nl">expectation</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"></span>


<span class="n">Total</span><span class="w"> </span><span class="nl">Duration</span><span class="p">:</span><span class="w"> </span><span class="mf">0.786</span><span class="n">s</span><span class="w"></span>
<span class="nf">Count</span><span class="err">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="nl">Failed</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">Skipped</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="nl">INFO</span><span class="p">:</span><span class="w"> </span><span class="n">Deleting</span><span class="w"> </span><span class="n">container</span><span class="w"></span>
</code></pre></div>

<h2>docker hub</h2>
<p>So now we have a working container on our local machine, but since sharing is caring I wanted to upload it to the <a href="https://hub.docker.com/">docker hub</a>. They have a feature to build your docker container based on a github repository. They also have documented the whole setup of <a href="https://docs.docker.com/docker-hub/builds/">automated</a> builds pretty good.</p>
<p>So for every git push a new docker image will be released on the docker hub. But they don't test the image before releasing it. </p>
<h2>travis</h2>
<p>So I looked around and found out this can be achieved by <a href="https://travis-ci.org/">travis</a>. I started writing a <a href="https://github.com/visibilityspots/dockerfile-openstackclient-kilo/blob/master/.travis.yml">travis.yml</a> file which will perform following steps;</p>
<div class="highlight"><pre><span></span><code><span class="n">sudo</span><span class="o">:</span> <span class="n">required</span>
<span class="n">services</span><span class="o">:</span>
<span class="o">-</span> <span class="n">docker</span>
<span class="n">before_install</span><span class="o">:</span>
<span class="o">-</span> <span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="n">https</span><span class="o">://</span><span class="n">goss</span><span class="o">.</span><span class="na">rocks</span><span class="o">/</span><span class="n">install</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">sh</span>
<span class="o">-</span> <span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">visibilityspots</span><span class="o">/</span><span class="n">openstackclient</span><span class="o">-</span><span class="n">kilo</span> <span class="o">.</span>
<span class="n">script</span><span class="o">:</span>
<span class="o">-</span> <span class="n">dgoss</span> <span class="n">run</span> <span class="o">--</span><span class="n">name</span> <span class="n">openstack</span><span class="o">-</span><span class="n">client</span> <span class="o">-</span><span class="n">ti</span> <span class="n">visibilityspots</span><span class="o">/</span><span class="n">openstackclient</span><span class="o">-</span><span class="n">kilo</span>
<span class="n">after_success</span><span class="o">:</span>
<span class="o">-</span> <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$TRAVIS_BRANCH&quot;</span> <span class="o">==</span> <span class="s2">&quot;master&quot;</span> <span class="o">];</span> <span class="n">then</span> <span class="n">docker</span> <span class="n">login</span> <span class="o">-</span><span class="n">u</span><span class="o">=</span><span class="n">visibilityspots</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s2">&quot;$DOCKER_PASSWORD&quot;</span><span class="o">;</span>
  <span class="n">docker</span> <span class="n">push</span> <span class="n">visibilityspots</span><span class="o">/</span><span class="n">openstackclient</span><span class="o">-</span><span class="n">kilo</span><span class="o">;</span> <span class="n">fi</span>
<span class="n">env</span><span class="o">:</span>
  <span class="n">global</span><span class="o">:</span>
    <span class="n">secure</span><span class="o">:</span> <span class="n">QA24IWGelQ6nd3Xuwzif8L</span><span class="o">+</span><span class="mi">2</span><span class="n">AeWC6M8V1jkZNJzJxaBLcxpucWcjkmowzaWGPmVfKeFAgfPsgVPfy8gK03JfY3J4H2AcCa8TWhVOoLvvY6ytFLobCWtRI8nIZoYeV8</span><span class="sr">/BNlKzguoE4OEfrloJUU52tQ/NDWVleH5KCBCj3H93eE52USwZ4JUyoZtngd+Zqma0GUomMvOZ0mg2e87UOYQNnCZehh5okAIU34sKGTGwEwWeqxA9xUvBd3l7pRj+5bfeQ07Fn0n3/tmrzFkOKRfCL2HC63Aq0T0LFjKsYza2QykiI5z4enNVjH8d+/05dCCHaj+/ZqKVQWbMi/RIheXk1XvsxPttBlHC03EXdQBfZmiNUUaxtVQ7f9Df0sRPvIrZsYzbHkeqVSHTNIGZLzY2cizLzIedYLOFGKNRM3WsOokIlsn+f/XciZse0D3YPBPzkRlI6sXMLtduxkZLzC1tRgyZhTl1A1kMbXzj94SJzftQ2NW7g0lbSO38DxsZcy4g/VlTDLmDzHvnlcdiU2KPSXgQcPZXQk/AZuZdl/AaYb9FIhP06GYRVRJfxls5qlxIAxxJsBTyBR4UE7SGq86UtZdTqzr/</span><span class="n">LjQXQr8SU</span><span class="o">+</span><span class="n">KfxvKbOvfBiIrqzMcBaRqQgPfTeKhI</span><span class="o">+</span><span class="n">jEhNyAlgnvSQNf8Eg9UgHv6aW51TqyI</span><span class="o">+</span><span class="n">RzVqIs</span><span class="o">=</span>
</code></pre></div>

<p>It will install dgoss and build the container locally on the travis infrastructure. Next it will run the dgoss tests based on the goss.yaml file. When those tests are finished it will upload the created and tested docker container to the docker hub.</p>
<p>To have travis authorized to push to the docker hub we have to provide him our docker credentials in a secure way. Luckily travis thought that through and provided us with the encrypt feature.</p>
<div class="highlight"><pre><span></span><code>$ travis encrypt <span class="nv">DOCKER_PASSWORD</span><span class="o">=</span>YOUR-DOCKER-HUB-PASSWORD --add
</code></pre></div>

<p>That way the password is stored into the travis environment variable $DOCKER_PASSWORD through an encrypted way as can be seen in your .travis.yaml file.</p>
<p>A detailled log will be provided on <a href="https://travis-ci.org/visibilityspots/dockerfile-openstackclient-kilo">travis</a></p>
<p>To get to this travis.yaml file I combined the <a href="https://docs.travis-ci.com/user/docker/">official</a> travis docker documentation with a <a href="https://sebest.github.io/post/using-travis-ci-to-build-docker-images/">tutorial</a> I found on the net.</p>
<p>Last but not least I had to disable the automatic build feature of the docker hub repository so only the travis builds will be pushed. That can be done on the "Build Settings" of the docker hub repository.</p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/docker.html">docker</a>, <a href="https://visibilityspots.github.io/blog/tag/hub.html">hub</a>, <a href="https://visibilityspots.github.io/blog/tag/automated.html">automated</a>, <a href="https://visibilityspots.github.io/blog/tag/github.html">github</a>, <a href="https://visibilityspots.github.io/blog/tag/container.html">container</a>, <a href="https://visibilityspots.github.io/blog/tag/openstack.html">openstack</a>, <a href="https://visibilityspots.github.io/blog/tag/openstackclient.html">openstackclient</a>, <a href="https://visibilityspots.github.io/blog/tag/tools.html">tools</a>, <a href="https://visibilityspots.github.io/blog/tag/source.html">source</a>, <a href="https://visibilityspots.github.io/blog/tag/at.html">at</a>, <a href="https://visibilityspots.github.io/blog/tag/run.html">run</a>, <a href="https://visibilityspots.github.io/blog/tag/rdo.html">rdo</a>, <a href="https://visibilityspots.github.io/blog/tag/kilo.html">kilo</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
    </body>
</html>