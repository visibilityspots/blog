<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Openstack live-migration
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">
        <link rel="stylesheet" media="screen and (prefers-color-scheme: dark)" href="https://files.stork-search.net/dark.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>
    <input data-stork="sitesearch" id="searchbox" type="text" size="12" placeholder="search">
    <div data-stork="sitesearch-output"></div>

    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
        <li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2022 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/openstack-live-migration.html" rel="bookmark"><h1>Openstack live-migration</h1></a>
<div><p>takes 0 minutes to read</p></div>                        <time class="post-time" datetime="2016-04-21T19:00:00+02:00" pubdate>
                            last modified at Thu 21 April 2016
                        </time>
                    </header>
                    <section class="post-content">
                        <p>Some of you may already have notices others just stumbled on this post through a search engine, I have set up an openstack private cloud at one of our projects:</p>
<ul>
<li><a href="https://visibilityspots.github.io/blog/vlan-flat-neutron-provider.html">vlan flat-neutron provider network</a></li>
<li><a href="https://visibilityspots.github.io/blog/openstack-layer2.html">layer2</a></li>
</ul>
<p>We have noticed that the benefits of having a private cloud is spreading through the different teams within the organization and therefore the interest into this flexibility is growing. Since this wasn't the original <a href="https://visibilityspots.github.io/blog/vlan-flat-neutron-provider.html">use case</a> we are encountering some design issues right now.</p>
<p>For the original instances the default <a href="http://docs.openstack.org/openstack-ops/content/compute_nodes.html#overcommit">overcommit</a> ratios are fine. But the request for new machines with other goals are like interfering with those original instances running in the same default <a href="http://docs.openstack.org/openstack-ops/content/scaling.html#az_s3">availability zone</a>.</p>
<p>So we are looking to configure some <a href="http://docs.openstack.org/openstack-ops/content/scaling.html#ha_s3">aggregate zones</a> to keep this under control. As soon as we figure out a workable solution I will write about it in a new blog post.</p>
<p>But in the discussions to come to a solution one remark was , couldn't openstack tackle the issues of having an hypervisor with a growing load and memory issues itself by migrating instances to another hypervisors? Which is like a valuable argument to me. So before even looking into such a solution the feature of live migration should work..</p>
<p>Since we aren't using shared storage for our cloud this could be tricky. So I went to the web to inform myself about the different options.</p>
<p>I came across some very interesting reads, like the one of <a href="https://thornelabs.net/2014/06/14/do-not-use-shared-storage-for-openstack-instances.html">Thornelabs</a> why you shouldn't use shared storage for example. Which has some valuable disadvantages of it besides the benefits. In our use case the benefits aren't outweighing against disadvantages. But as I have noticed in the whole openstack story there are options for almost every cloud use case and therefore the logical complexity of it. So for many amongst you shared storage could be a solution.</p>
<p>Another rather interesting one about live migration as a <a href="https://www.blueboxcloud.com/insight/blog-article/live-migration-is-a-perk-not-a-panacea">perk not a panacea</a></p>
<p>One of the <a href="http://docs.openstack.org/openstack-ops/content/compute_nodes.html#instance_storage">options</a> is <a href="http://docs.openstack.org/openstack-ops/content/compute_nodes.html#on_compute_node_storage_nonshared">non shared</a> storage, the default of the RDO packstack installer, based on LVM. On our setup we are using this default.</p>
<p>This has the consequence we can only use the live migration about with the kvm block storage <a href="http://www.sebastien-han.fr/blog/2012/07/12/openstack-block-migration/">migration</a> which isn't really <a href="http://osdir.com/ml/openstack-cloud-computing/2012-08/msg00293.html">supported</a> by the upstream developers and will probably phased out in the future for something more reliable.</p>
<p>We configured <a href="http://docs.openstack.org/user-guide/cli_config_drive.html">config drives</a> as the default to get the metadata served to cloud-init at boot time for an instance. The default drive format (iso9660) has a bug in libvirt of copying a read-only disk. To tackle this one we configured the vfat format on all hypervisors.</p>
<p>Unfortunately this still doesn't solve our issue with it. Apparently when you use the live migrate option openstack <a href="https://bugs.launchpad.net/nova/+bug/1214943">doesn't</a> take the overcommit ratio into account. Since our cloud is already overcommitted we don't have enough resources according to the live migration precheck to move instances around..</p>
<p>The proposed fix isn't released yet in the RDO kilo nova packages and patching a system isn't something I like to do in a semi-production environment.</p>
<p>So until today live migration isn't something we have tackled yet on our cloud. If you have solved this on your kilo RDO release cloud already feel free to enlighten me about it!</p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/openstack.html">openstack</a>, <a href="https://visibilityspots.github.io/blog/tag/live.html">live</a>, <a href="https://visibilityspots.github.io/blog/tag/migration.html">migration</a>, <a href="https://visibilityspots.github.io/blog/tag/kilo.html">kilo</a>, <a href="https://visibilityspots.github.io/blog/tag/kvm.html">kvm</a>, <a href="https://visibilityspots.github.io/blog/tag/block.html">block</a>, <a href="https://visibilityspots.github.io/blog/tag/config.html">config</a>, <a href="https://visibilityspots.github.io/blog/tag/drive.html">drive</a>, <a href="https://visibilityspots.github.io/blog/tag/vfat.html">vfat</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
        <script src="https://files.stork-search.net/releases/v1.2.1/stork.js"></script>
        <script>
            stork.register("sitesearch", "https://visibilityspots.github.io/blog/search-index.st")
        </script>
    </body>
</html>