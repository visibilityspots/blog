<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Archlinux ARM pi zero cups network print server
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">
        <link rel="stylesheet" media="screen and (prefers-color-scheme: dark)" href="https://files.stork-search.net/dark.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>
    <input data-stork="sitesearch" id="searchbox" type="text" size="12" placeholder="search">
    <div data-stork="sitesearch-output"></div>

    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
        <li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2022 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/print-server.html" rel="bookmark"><h1>Archlinux ARM pi zero cups network print server</h1></a>
<div><p>takes 1 minute to read</p></div>                        <time class="post-time" datetime="2018-12-26T19:00:00+01:00" pubdate>
                            last modified at Thu 18 March 2021
                        </time>
                    </header>
                    <section class="post-content">
                        <h2>Printing</h2>
<p>Probably like many amongst us the time of the Christmas holidays is perfect to get some IT related stuff back on track. I used to have a print server setup which got broken over time and I didn't found the energy to invest time into fixing it. But the pressure became higher and higher.
111
From both my wife and daughter, especially during the holidays where the wife want to use it to print out tickets and the daughter want to print out color plates..</p>
<p>So during one of the evenings I pulled myself together and installed <a href="https://archlinuxarm.org/">ArchLinux ARM</a> on a pi zero w and went through the following configuration.</p>
<p>First off all install and configure cups on the pi zero following the <a href="https://wiki.archlinux.org/index.php/CUPS">Arch wiki</a></p>
<p>Do not configure any printer yet, only install cups. When following the guide you can also set cups to be <a href="https://wiki.archlinux.org/index.php/CUPS/Printer_sharing#Remote_administration">available</a> on our local network through the browser on port 631;</p>
<div class="highlight"><pre><span></span><code># <span class="nv">vim</span> <span class="o">/</span><span class="nv">etc</span><span class="o">/</span><span class="nv">cups</span><span class="o">/</span><span class="nv">cupsd</span>.<span class="nv">conf</span>
# <span class="nv">Only</span> <span class="nv">listen</span> <span class="k">for</span> <span class="nv">connections</span> <span class="nv">from</span> <span class="nv">the</span> <span class="nv">local</span> <span class="nv">machine</span>.
#<span class="nv">Listen</span> <span class="nv">localhost</span>:<span class="mi">631</span>
<span class="nv">Port</span> <span class="mi">631</span>
<span class="nv">Listen</span> <span class="o">/</span><span class="nv">run</span><span class="o">/</span><span class="nv">cups</span><span class="o">/</span><span class="nv">cups</span>.<span class="nv">sock</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code># Restrict access to the server...
<span class="nt">&lt;Location</span> <span class="nt">/&gt;</span>
  Order allow,deny
  Allow from @LOCAL
<span class="nt">&lt;/Location&gt;</span>

# Restrict access to the admin pages...
<span class="nt">&lt;Location</span> <span class="err">/admin</span><span class="nt">&gt;</span>
  Order allow,deny
  Allow from @LOCAL
<span class="nt">&lt;/Location&gt;</span>

# Restrict access to configuration files...
<span class="nt">&lt;Location</span> <span class="err">/admin/conf</span><span class="nt">&gt;</span>
  AuthType Default
  Require user @SYSTEM
  Order allow,deny
  Allow from @LOCAL
<span class="nt">&lt;/Location&gt;</span>
</code></pre></div>

<p>Once that's done you can start the cups service and enable it to start at boot;</p>
<div class="highlight"><pre><span></span><code># systemctl start cups.service
# systemctl enable cups.service
</code></pre></div>

<p>Next we will configure the USB connected printers as raw on the pi.</p>
<p>first get your printer USB handle</p>
<div class="highlight"><pre><span></span><code># lpinfo -v | grep usb:
direct usb://Samsung/CLP-310%20Series?serial=################
</code></pre></div>

<p>add a new printer with the found USB handle</p>
<div class="highlight"><pre><span></span><code># lpadmin -p Visibilityspots-LaserJet -v usb://Samsung/CLP-310%20Series?serial=##################
# lpstat -p Visibilityspots-LaserJet -l
printer Visibilityspots-LaserJet disabled since Mon Dec 24 20:51:24 2018 -
    reason unknown
</code></pre></div>

<p>enable the printer</p>
<div class="highlight"><pre><span></span><code># cupsenable Visibilityspots-LaserJet
# lpstat -p Visibilityspots-LaserJet -l
printer Visibilityspots-LaserJet is idle.  enabled since Mon Dec 24 20:51:54 2018
</code></pre></div>

<p>make the printer accept jobs</p>
<div class="highlight"><pre><span></span><code># cupsaccept Visibilityspots-LaserJet
</code></pre></div>

<p>We do have a server now which can accept print jobs.</p>
<p>But before sending print request we need to configure our clients too. Since we configured a raw printer we need to install the printer drivers on the clients. Depending on you distribution you need to install some specific packages for the specific print drivers for your printer.</p>
<p>I on my ArchLinux I had to install the packages samsung-drivers for my samsung printer and hplib for the hp one.</p>
<p>To get the printers configured I just used the cups web interface on my machine and used the URI <em>http://IP-ADDRESS-PRINT-SERVER-ON-A-PI:631/printers/Visibilityspots-DeskJet</em> in combination with the driver for the specific model.</p>
<p>After that I could easily print the common know print test page which magically printer the tux!!</p>
<h2>Scan</h2>
<p>Besides printing I also wanted to enable the scan option on one of the dives over the network.</p>
<p>This was rather easy as being described on the <a href="https://wiki.archlinux.org/index.php/Sane#Sharing_your_scanner_over_a_network">ArchWiki</a> after I installed both sane and hp-lib on the print-server too.</p>
<p>Do not forget to enable the saned.socket systemd service on your print-server!</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl <span class="nb">enable</span> saned.socket
</code></pre></div>

<p>And now I'm able to put something in the scanner bed and execute a custom scan function I wrote in my zsh config</p>
<div class="highlight"><pre><span></span><code>$ scan test-image
</code></pre></div>

<p>zsh config:</p>
<div class="highlight"><pre><span></span><code>scan () {
    scanimage --device &quot;net:IP-ADDRESS-PRINT-SERVER-ON-A-PI:hpaio:/usb/Deskjet_F4100_series?serial=#################&quot; --resolution 600 -p | pnmtops | ps2pdf - &quot;$1.pdf&quot;
    }
</code></pre></div>

<p>which creates a pdf file in the current directory based on the scanned file.</p>
<p>So yipeeyayee I do now have again a working network based print/scan setup without too much effort and still using our old offline printer setups!!</p>
<p>references:</p>
<ul>
<li><a href="https://stackoverflow.com/questions/26329186/creating-a-raw-printer-queue-in-cups-host-and-adding-them-through-cups-client">https://stackoverflow.com/questions/26329186/creating-a-raw-printer-queue-in-cups-host-and-adding-them-through-cups-client</a></li>
<li><a href="https://forum.manjaro.org/t/how-to-set-up-a-remote-printer-which-is-attached-to-a-raspberry-pi-or-any-other-arm-computer/57056y">https://forum.manjaro.org/t/how-to-set-up-a-remote-printer-which-is-attached-to-a-raspberry-pi-or-any-other-arm-computer/57056y</a></li>
</ul>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/cups.html">cups</a>, <a href="https://visibilityspots.github.io/blog/tag/pi.html">pi</a>, <a href="https://visibilityspots.github.io/blog/tag/zero.html">zero</a>, <a href="https://visibilityspots.github.io/blog/tag/w.html">w</a>, <a href="https://visibilityspots.github.io/blog/tag/print.html">print</a>, <a href="https://visibilityspots.github.io/blog/tag/server.html">server</a>, <a href="https://visibilityspots.github.io/blog/tag/archlinux.html">archlinux</a>, <a href="https://visibilityspots.github.io/blog/tag/arm.html">arm</a>, <a href="https://visibilityspots.github.io/blog/tag/sane.html">sane</a>, <a href="https://visibilityspots.github.io/blog/tag/scan.html">scan</a>, <a href="https://visibilityspots.github.io/blog/tag/remote.html">remote</a>, <a href="https://visibilityspots.github.io/blog/tag/scanimage.html">scanimage</a>, <a href="https://visibilityspots.github.io/blog/tag/hp.html">hp</a>, <a href="https://visibilityspots.github.io/blog/tag/samsung.html">samsung</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
        <script src="https://files.stork-search.net/releases/v1.2.1/stork.js"></script>
        <script>
            stork.register("sitesearch", "https://visibilityspots.github.io/blog/search-index.st")
        </script>
    </body>
</html>