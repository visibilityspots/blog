<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Raspberry pi setup
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">
        <link rel="stylesheet" media="screen and (prefers-color-scheme: dark)" href="https://files.stork-search.net/dark.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>
    <input data-stork="sitesearch" id="searchbox" type="text" size="12" placeholder="search">
    <div data-stork="sitesearch-output"></div>

    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
        <li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2025 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/raspberry-pi.html" rel="bookmark"><h1>Raspberry pi setup</h1></a>
<div><p>takes 2 minutes to read</p></div>                        <time class="post-time" datetime="2014-05-16T19:00:00+02:00" pubdate>
                            last modified at Mon 04 August 2014
                        </time>
                    </header>
                    <section class="post-content">
                        <p>Since I discovered the joy of linux servers over desktop distributions a few years ago I revived an old portable and promoted him to be my home server.</p>
<p>Connected him our router in the little storage room on a top shelf gathering dust I could test, configure, break (and pass sleep) a huge variety of open-source software.</p>
<p>Many of those adventures I also used to provide my blog with content. After a while I figured this setup isn't really needed to be powered on 24h a day 7 days a week. So I bought myself a <a href="http://www.raspberrypi.org/">raspberry pi</a> which would cover the basic functionalities I needed to be online as much as possible without the need of a subscription for a VPS or dedicated server in one fancy pansy data center.</p>
<p>For the operating system I didn't choose for the default <a href="http://www.raspbian.org">raspbian</a>, mainly because I don't need a graphical interface. So I headed over to archlinux arm, also called <a href="http://archlinuxarm.org/platforms/armv6/raspberry-pi">alarm</a>.</p>
<p>The <a href="http://archlinuxarm.org/platforms/armv6/raspberry-pi#qt-platform_tabs-ui-tabs2">installation</a> is quite straight forward. After that I installed and configured some other stuff on it to gather my ultimate personal little mini server:</p>
<ul>
<li><a href="https://wiki.archlinux.org/index.php/vim">vim</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Secure_Shell">ssh</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Secure_Shell#SSH_alternative:_Mobile_Shell_-_responsive.2C_survives_disconnects">mosh</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Noip">noip</a></li>
<li><a href="https://wiki.archlinux.org/index.php/GNU_Screen">screen</a></li>
<li><a href="https://wiki.archlinux.org/index.php/yaourt">yaourt</a></li>
<li><a href="https://wiki.archlinux.org/index.php/pkgfile">pkgfile</a></li>
<li><a href="https://www.archlinux.org/packages/extra/any/bash-completion/">bash-completion</a></li>
<li><a href="https://www.archlinux.org/packages/community/x86_64/ncdu/">ncdu</a></li>
<li><a href="https://www.archlinux.org/packages/extra/x86_64/htop/">htop</a></li>
<li><a href="https://wiki.archlinux.org/index.php/locate">mlocate</a></li>
<li><a href="https://wiki.archlinux.org/index.php/msmtp">msmtp</a></li>
<li><a href="https://wiki.archlinux.org/index.php/locale">locale</a></li>
<li><a href="https://wiki.archlinux.org/index.php/time">timedatectl</a></li>
<li><a href="https://github.com/xanmanning/alarm-fake-hwclock">fake-hwclock</a></li>
<li><a href="https://github.com/axkibe/lsyncd">lsyncd</a></li>
</ul>
<h1>Partitioning</h1>
<p>After a while I couldn't update any packages anymore cause my root partition was full. When looking at the partitions I noticed I had only 1.7G for my root partition available but I installed it on a 4G sd card.</p>
<p>Looking for a solution I discovered the base image I copied over is by default configured for 2G cards. You have to expand the file system yourself if you want to benefit the full amount of storage on your sd card.</p>
<p>Following this <a href="http://jan.alphadev.net/post/53594241659/growing-the-rpi-root-partition">tutorial</a> I found on the net I achieved to grow my root partition without extracting the sd card.</p>
<h1>RAM</h1>
<p>Using ssh I will only use terminal connections to the pi without any graphical interfaces though the HDMI socket. By default the memory of the pi is shared for those graphical stuff and normal os operations.</p>
<p>I decided to decrease the amount of memory for the gpu by setting those amounts into the /boot/config.txt file:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nv">gpu_mem_512</span><span class="o">=</span><span class="m">48</span>
<span class="w">    </span><span class="nv">gpu_mem_256</span><span class="o">=</span><span class="m">48</span>
</code></pre></div>

<p>That way I could benefit of more memory for the stuff I will run on the pi.</p>
<h1>Communication</h1>
<p>To be online day and night I installed a chat client using <a href="https://wiki.archlinux.org/index.php/Screen_Irssi_Bitlbee">bitlbee and irssi</a>. When I am not connected to this chat terminal and I get some message on one of the connected channels a notification will be sent through my android phone using <a href="https://irssinotifier.appspot.com/">irssinotifier</a> so I could decide if it's important enough to connect using my phone, <a href="https://play.google.com/store/apps/details?id=com.sonelli.juicessh">juicessh</a> or spin up my laptop.</p>
<p>Be sure to check out all the nifty <a href="http://scripts.irssi.org/">scripts</a> which can increase the joy of using the irssi chat client.</p>
<h1>RAID</h1>
<p>For one of projects running at <a href="https://www.inuits.eu">inuits</a> I was asked to set up a software raid using <a href="http://en.wikipedia.org/wiki/Mdadm">mdadm</a>. Through the years I have collected a bunch of USB disks.</p>
<p>Combining those two facts I figured I could set up a raid using a little usb hub.</p>
<h2>Model B</h2>
<p>I am aware of the bottle neck this hub creates to the raid setup but since it's not for a production environment and I like to play around I doesn't care about it :)</p>
<p><img alt="raspberry" src="../../images/raspberry/raspberry.jpg"></p>
<h2>Model B+</h2>
<p>An updated model of the raspberry pi was launched, the <a href="http://www.raspberrypi.org/introducing-raspberry-pi-model-b-plus/">model b+</a> extended with to 4 USB ports in total. So finally I could gain benefit of my raid setup.</p>
<p>I reconfigured my whole RAID setup by using those 4 individual USB sockets instead of the hub I used before. And man what a difference! It runs a lot faster and is a lot more use full and efficient nowadays.</p>
<p>Since there are no case available yet for this model I looked on <a href="http://thingiverse.com">thingiverse</a> and found a closed <a href="http://www.thingiverse.com/thing:398399">case</a> which I printed out on the ultimaker2 robot we can use at the office. It's a neat case but the top isn't clicked in to the bottom part so I had to use tape to stick them together..</p>
<p><img alt="raspberry-b-open" src="../../images/raspberry/raspberry-b-open.jpg">
<img alt="raspberry-b-closed" src="../../images/raspberry/raspberry-b-closed.jpg"></p>
<h1>Configuration</h1>
<p>This whole setup is based on the well documented archlinux wiki <a href="https://wiki.archlinux.org/index.php/RAID">page</a></p>
<p>4 sticks of 2 GB were formatted to ext4:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># mkfs.ext4 /dev/sdXX -L NAME</span>
</code></pre></div>

<p>Next step was to identify the UUID's of those freshly created volumes so I could use those to initialize the actual raid setup.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>$<span class="w"> </span>sudo<span class="w"> </span>blkid
<span class="w">  </span>/dev/sde1:<span class="w"> </span><span class="nv">LABEL</span><span class="o">=</span><span class="s2">&quot;three&quot;</span><span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="s2">&quot;39564f64-18ed-4f0b-a2d8-9b2d7c62032a&quot;</span><span class="w"> </span><span class="nv">TYPE</span><span class="o">=</span><span class="s2">&quot;ext4&quot;</span><span class="w"> </span><span class="nv">PARTUUID</span><span class="o">=</span><span class="s2">&quot;91f72d24-01&quot;</span>
<span class="w">  </span>/dev/sdb1:<span class="w"> </span><span class="nv">LABEL</span><span class="o">=</span><span class="s2">&quot;four&quot;</span><span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="s2">&quot;9b37dc7f-3f0c-44ba-846b-e9ba9efaa03a&quot;</span><span class="w"> </span><span class="nv">TYPE</span><span class="o">=</span><span class="s2">&quot;ext4&quot;</span><span class="w"> </span><span class="nv">PARTUUID</span><span class="o">=</span><span class="s2">&quot;688434a6-01&quot;</span>
<span class="w">  </span>/dev/sdd1:<span class="w"> </span><span class="nv">LABEL</span><span class="o">=</span><span class="s2">&quot;two&quot;</span><span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="s2">&quot;321d1d03-eb87-4129-83c7-ee1ce232d1c1&quot;</span><span class="w"> </span><span class="nv">TYPE</span><span class="o">=</span><span class="s2">&quot;ext4&quot;</span><span class="w"> </span><span class="nv">PARTUUID</span><span class="o">=</span><span class="s2">&quot;9852d7fa-01&quot;</span>
<span class="w">  </span>/dev/sdc1:<span class="w"> </span><span class="nv">LABEL</span><span class="o">=</span><span class="s2">&quot;one&quot;</span><span class="w"> </span><span class="nv">UUID</span><span class="o">=</span><span class="s2">&quot;d61e46bd-9a28-427e-9a85-94dc292463ec&quot;</span><span class="w"> </span><span class="nv">TYPE</span><span class="o">=</span><span class="s2">&quot;ext4&quot;</span><span class="w"> </span><span class="nv">PARTUUID</span><span class="o">=</span><span class="s2">&quot;00099342-01&quot;</span>
</code></pre></div>

<p>Using the gathered UUID's I then created a raid5 using 3 active sticks and one as hot spare device:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>$<span class="w"> </span>sudo<span class="w"> </span>mdadm<span class="w"> </span>--create<span class="w"> </span>--verbose<span class="w"> </span>--level<span class="o">=</span><span class="m">5</span><span class="w"> </span>--metadata<span class="o">=</span><span class="m">1</span>.2<span class="w"> </span>--chunk<span class="o">=</span><span class="m">256</span><span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">3</span><span class="w"> </span>/dev/md0<span class="w"> </span>/dev/disk/by-uuid/d61e46bd-9a28-427e-9a85-94dc292463ec<span class="w"> </span>/dev/disk/by-uuid/321d1d03-eb87-4129-83c7-ee1ce232d1c1<span class="w"> </span>/dev/disk/by-uuid/39564f64-18ed-4f0b-a2d8-9b2d7c62032a<span class="w"> </span>--spare-devices<span class="o">=</span><span class="m">1</span><span class="w"> </span>/dev/disk/by-uuid/9b37dc7f-3f0c-44ba-846b-e9ba9efaa03a
<span class="w">  </span>mdadm:<span class="w"> </span>layout<span class="w"> </span>defaults<span class="w"> </span>to<span class="w"> </span>left-symmetric
<span class="w">  </span>mdadm:<span class="w"> </span>/dev/disk/by-uuid/d61e46bd-9a28-427e-9a85-94dc292463ec<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>an<span class="w"> </span>ext2fs<span class="w"> </span>file<span class="w"> </span>system
<span class="w">       </span><span class="nv">size</span><span class="o">=</span>1982464K<span class="w">  </span><span class="nv">mtime</span><span class="o">=</span>Thu<span class="w"> </span>Jan<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">01</span>:00:00<span class="w"> </span><span class="m">1970</span>
<span class="w">  </span>mdadm:<span class="w"> </span>/dev/disk/by-uuid/321d1d03-eb87-4129-83c7-ee1ce232d1c1<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>an<span class="w"> </span>ext2fs<span class="w"> </span>file<span class="w"> </span>system
<span class="w">       </span><span class="nv">size</span><span class="o">=</span>2013184K<span class="w">  </span><span class="nv">mtime</span><span class="o">=</span>Thu<span class="w"> </span>Jan<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">01</span>:00:00<span class="w"> </span><span class="m">1970</span>
<span class="w">  </span>mdadm:<span class="w"> </span>/dev/disk/by-uuid/39564f64-18ed-4f0b-a2d8-9b2d7c62032a<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>an<span class="w"> </span>ext2fs<span class="w"> </span>file<span class="w"> </span>system
<span class="w">       </span><span class="nv">size</span><span class="o">=</span>2013184K<span class="w">  </span><span class="nv">mtime</span><span class="o">=</span>Thu<span class="w"> </span>Jan<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">01</span>:00:00<span class="w"> </span><span class="m">1970</span>
<span class="w">  </span>mdadm:<span class="w"> </span>/dev/disk/by-uuid/9b37dc7f-3f0c-44ba-846b-e9ba9efaa03a<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>contain<span class="w"> </span>an<span class="w"> </span>ext2fs<span class="w"> </span>file<span class="w"> </span>system
<span class="w">       </span><span class="nv">size</span><span class="o">=</span>1982464K<span class="w">  </span><span class="nv">mtime</span><span class="o">=</span>Thu<span class="w"> </span>Jan<span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">01</span>:00:00<span class="w"> </span><span class="m">1970</span>
<span class="w">  </span>mdadm:<span class="w"> </span>size<span class="w"> </span><span class="nb">set</span><span class="w"> </span>to<span class="w"> </span>1981440K
<span class="w">  </span>mdadm:<span class="w"> </span>largest<span class="w"> </span>drive<span class="w"> </span><span class="o">(</span>/dev/disk/by-uuid/321d1d03-eb87-4129-83c7-ee1ce232d1c1<span class="o">)</span><span class="w"> </span>exceeds<span class="w"> </span>size<span class="w"> </span><span class="o">(</span>1981440K<span class="o">)</span><span class="w"> </span>by<span class="w"> </span>more<span class="w"> </span>than<span class="w"> </span><span class="m">1</span>%
<span class="w">  </span>Continue<span class="w"> </span>creating<span class="w"> </span>array?<span class="w"> </span>y
<span class="w">  </span>mdadm:<span class="w"> </span>array<span class="w"> </span>/dev/md0<span class="w"> </span>started.
</code></pre></div>

<p>You can see the progress of the creation by:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span>cat<span class="w"> </span>/proc/mdstat
<span class="w">  </span>Personalities<span class="w"> </span>:<span class="w"> </span><span class="o">[</span>linear<span class="o">]</span><span class="w"> </span><span class="o">[</span>raid0<span class="o">]</span><span class="w"> </span><span class="o">[</span>raid1<span class="o">]</span><span class="w"> </span><span class="o">[</span>raid10<span class="o">]</span><span class="w"> </span><span class="o">[</span>raid6<span class="o">]</span><span class="w"> </span><span class="o">[</span>raid5<span class="o">]</span><span class="w"> </span><span class="o">[</span>raid4<span class="o">]</span><span class="w"> </span><span class="o">[</span>multipath<span class="o">]</span><span class="w"> </span><span class="o">[</span>faulty<span class="o">]</span>
<span class="w">  </span>md0<span class="w"> </span>:<span class="w"> </span>active<span class="w"> </span>raid5<span class="w"> </span>sde1<span class="o">[</span><span class="m">4</span><span class="o">]</span><span class="w"> </span>sdb1<span class="o">[</span><span class="m">3</span><span class="o">](</span>S<span class="o">)</span><span class="w"> </span>sdd1<span class="o">[</span><span class="m">1</span><span class="o">]</span><span class="w"> </span>sdc1<span class="o">[</span><span class="m">0</span><span class="o">]</span>
<span class="w">        </span><span class="m">3962880</span><span class="w"> </span>blocks<span class="w"> </span>super<span class="w"> </span><span class="m">1</span>.2<span class="w"> </span>level<span class="w"> </span><span class="m">5</span>,<span class="w"> </span>256k<span class="w"> </span>chunk,<span class="w"> </span>algorithm<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">[</span><span class="m">3</span>/2<span class="o">]</span><span class="w"> </span><span class="o">[</span>UU_<span class="o">]</span>
<span class="w">        </span><span class="o">[</span>&gt;....................<span class="o">]</span><span class="w">  </span><span class="nv">recovery</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="m">1</span>.8%<span class="w"> </span><span class="o">(</span><span class="m">36960</span>/1981440<span class="o">)</span><span class="w"> </span><span class="nv">finish</span><span class="o">=</span><span class="m">96</span>.5min<span class="w"> </span><span class="nv">speed</span><span class="o">=</span>335K/sec
<span class="w">  </span>unused<span class="w"> </span>devices:<span class="w"> </span>&lt;none&gt;
</code></pre></div>

<p>Once the creation process has been done you can start by updating the configuration:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># mdadm --detail --scan &gt;&gt; /etc/mdadm.conf</span>
<span class="w">  </span><span class="c1"># mdadm --assemble --scan</span>
</code></pre></div>

<p>And we finally can create a file system on the raid itself:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># mkfs.ext4 -v -L NAME -m 0.5 -b 4096 -E stride=64,stripe-width=192 /dev/md0</span>
</code></pre></div>

<h2>Issues</h2>
<p>Since the raspberry is powered by the USB slot of my ISP's modem and they quite often restart their device for software updates the pi also rebooted from time to time. During such reboots I figured that the process of mounting the raid volume got stuck.</p>
<p>This because the hardware came up to slowly and the mounting process didn't recognized the usb sticks. So I wrote this script (/usr/bin/start-communication) which does the magic (after many try and error attempts).</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1">#!/bin/bash</span>
<span class="w">  </span><span class="c1">#</span>
<span class="w">  </span><span class="c1"># Script which mounts the RAID volume storage before starting an irssi screen session</span>

<span class="w">  </span><span class="c1"># Mount the storage RAID volume</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span>!<span class="w"> </span>df<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>NAME<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">     </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;10 sec break...&quot;</span><span class="p">;</span><span class="w"> </span>sleep<span class="w"> </span><span class="m">10</span>
<span class="w">     </span>sudo<span class="w"> </span>mount<span class="w"> </span>/dev/md0<span class="w"> </span>/NAME
<span class="w">  </span><span class="k">done</span>

<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;storage mounted&quot;</span>

<span class="w">  </span><span class="c1"># Start irssi in a screen session as user &#39;X&#39;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span>!<span class="w"> </span>screen<span class="w"> </span>-list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>irssi<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span>sudo<span class="w"> </span>-u<span class="w"> </span>X<span class="w"> </span>/usr/bin/screen<span class="w"> </span>-dmS<span class="w"> </span>irssi<span class="w"> </span>irssi<span class="p">;</span><span class="w"> </span><span class="k">fi</span>

<span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;irssi screen session started&quot;</span>
</code></pre></div>

<p>This script is triggered by cron after every reboot.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nv">@reboot</span><span class="w"> </span><span class="k">start</span><span class="o">-</span><span class="n">communication</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">startup</span><span class="p">.</span><span class="nf">log</span>
</code></pre></div>

<p>And the output is logged in the file /tmp/startup.log.</p>
<h1>Backup</h1>
<h2>image</h2>
<p>Once a week I overnight I have a cron job running which creates a compressed image file of the whole sd card of my running pi and pushes it to a mounted network share on my <a href="http://www.trustedreviews.com/iomega-tv-with-boxee_DVRs-and-Media-players-_review">boxee</a> iomega device.</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="c1">#!/bin/bash</span>
<span class="w">    </span><span class="nv">DATE</span><span class="o">=</span><span class="k">$(</span>date<span class="w"> </span>+%d-%m-%Y<span class="k">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span>/usr/bin/mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>MOUNT<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span>dd<span class="w"> </span><span class="k">if</span><span class="o">=</span>/dev/mmcblk0<span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>-1<span class="w"> </span>-<span class="w"> </span><span class="p">|</span><span class="w"> </span>dd<span class="w"> </span><span class="nv">of</span><span class="o">=</span>MOUNT/backup-<span class="nv">$DATE</span>.img.gz
<span class="w">    </span><span class="k">fi</span>
</code></pre></div>

<p>That way I can easily pull this image onto a new sd card if there goes something wrong with the existing one without the need of reinstalling everything</p>
<h2>directory backup</h2>
<p>For some minor applications like irssi I use <a href="https://github.com/axkibe/lsyncd">lsyncd</a> to sync between different machines. I have one daemon running which is used to backup directories to a network share and another one to mirror between different machines through ssh.</p>
<h1>VPN</h1>
<p>One of the next steps will be a vpn setup based on this <a href="https://raymii.org/s/tutorials/IPSEC_L2TP_vpn_on_a_Raspberry_Pi_with_Arch_Linux.html">tutorial</a></p>
<h1>Wake on lan</h1>
<p>Once I got configured the VPN setup I will reconfigure my old laptop as being an <a href="https://visibilityspots.com/sms-server.html">sms-service</a>. Since I don't need this service being up all the time I will configure the wake on lan service on that laptop.</p>
<p>That way I can get him up from remote by logging in at my pi and sending the magical WOL packet to that laptop.</p>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/raspberry.html">raspberry</a>, <a href="https://visibilityspots.github.io/blog/tag/pi.html">pi</a>, <a href="https://visibilityspots.github.io/blog/tag/archlinux.html">archlinux</a>, <a href="https://visibilityspots.github.io/blog/tag/arm.html">ARM</a>, <a href="https://visibilityspots.github.io/blog/tag/software.html">software</a>, <a href="https://visibilityspots.github.io/blog/tag/raid.html">RAID</a>, <a href="https://visibilityspots.github.io/blog/tag/mdadm.html">mdadm</a>, <a href="https://visibilityspots.github.io/blog/tag/irssi.html">irssi</a>, <a href="https://visibilityspots.github.io/blog/tag/bitlbee.html">bitlbee</a>, <a href="https://visibilityspots.github.io/blog/tag/usb.html">usb</a>, <a href="https://visibilityspots.github.io/blog/tag/disks.html">disks</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
        <script src="https://files.stork-search.net/releases/v1.2.1/stork.js"></script>
        <script>
            stork.register("sitesearch", "https://visibilityspots.github.io/blog/search-index.st")
        </script>
    </body>
</html>