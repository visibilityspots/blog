<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    SMS server using CentOS, kannel and playsms
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">
	<link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/tipuesearch/tipuesearch.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>
    <form id="searchform" action="https://visibilityspots.github.io/blog/search.html" onsubmit="return (this.elements['q'].value.length > 0)">
	        <input id="searchbox" type="text" name="q" size="12" placeholder="search">
    </form>
    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
	<li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
	<li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2021 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/sms-server.html" rel="bookmark"><h1>SMS server using CentOS, kannel and playsms</h1></a>
<div><p>takes 2 minutes to read</p></div>                        <time class="post-time" datetime="2012-07-24T11:34:00+02:00" pubdate>
                            last modified at Tue 24 July 2012
                        </time>
                    </header>
                    <section class="post-content">
                        <p>On this page I will describe the way I went trough to configure an sms gateway using a laptop, <a class="reference external" href="http://www.business.vodafone.com/site/bus/public/enuk/support/10_productsupport/usb_stick/01_vodafone/02_vodafone_k3565/20_software/p_software.jsp">huawei</a> modem, <a class="reference external" href="http://www.falcom.de">falcom</a> A2D-1 or the <a class="reference external" href="http://www.option.com/support/globe-trotter-hsdpa">option</a> Globetrotter hardware using the open source software <a class="reference external" href="http://www.kannel.org/">kannel</a> &amp; <a class="reference external" href="http://playsms.org/">playsms</a>.</p>
<p>The main goal of this project was related to the scouting movement in Belgium I'm active. We wanted to interrogate all of our members who were on a start weekend of the next scouting year. To do this we had the idea to use the sms communication channel. This because almost every youngster has the possibility to send sms messages without a big effort.</p>
<p>To achieve this I searched on the internet and found the <a class="reference external" href="http://playsms.org/">playsms</a> software. Using this software you can easily add an interactive flow to communicate with people using sms. We used the sms quiz where we added some questions with keywords were people could answer to and we replied with a next question.</p>
<p>As mobile provider we choose for <a class="reference external" href="http://www.mobilevikings.com">Mobile Vikings</a> a belgium operator with an open-mind. They were very helpfull when I contacted them to see if they could monitor some mobile traffic for my sim.</p>
<p>But before this software can handle your sms messages they have to be captured and received using a SIM card and pushed to the software. This step in the whole process can be done by <a class="reference external" href="http://www.kannel.org/">kannel</a>.</p>
<div class="section" id="process-using-centos-6-3-minimal-installation">
<h2>Process using CentOS 6.3 minimal installation</h2>
<p>Install some required dependency packages:</p>
<pre class="literal-block">
# yum install gcc&nbsp;libxml2-devel mysql-server&nbsp;wvdial vim
</pre>
<p>Looking for the modem:</p>
<pre class="literal-block">
# wvdialconf /etc/wvdial.conf
Found a modem on **/dev/ttyUSB0**
</pre>
</div>
<div class="section" id="minicom">
<h2>Minicom</h2>
<p>Before starting configuring the services which were going to communicate with the modem I wanted to make sure I could send text messages with it. To check that functionality I installed the <a class="reference external" href="http://linux.die.net/man/1/minicom">minicom</a> serial communication program:</p>
<pre class="literal-block">
# yum install minicom
# minicom
</pre>
<p>In this terminal you can control the modem using AT commands. A nice tutorial about those commands is available on <a class="reference external" href="http://qualityguru.wordpress.com/test-status-to-smsmms/">qualityguru</a>.</p>
<p>Steps for entering the PIN.</p>
<pre class="literal-block">
AT+CPIN=XXXX
OK
AT+CPIN?
+CPIN: READY
OK
</pre>
<p>Checking if the SMS center is configured:</p>
<pre class="literal-block">
AT+CSCA?
+CSCA: &quot;+32XXXXXXXXX&quot;,145
OK
</pre>
<p>If not configured, configure it by:</p>
<pre class="literal-block">
AT+CSCA=&quot;+32XXXXXXXXX&quot;
OK
</pre>
<p>The steps for sending a text message:</p>
<pre class="literal-block">
AT+CMGF=1
OK
AT+CMGS=&quot;+32XXXXXXXXX&quot;
&gt; This is the text message.
&gt; (CTRL-Z)
+CMGS: XX
OK
</pre>
<p>If you received the message on your phone its working obviously and we can start configuring kannel.</p>
<p>If not, check the <a class="reference external" href="http://qualityguru.wordpress.com/2010/03/02/test-status-to-smsmms-trouble-shooting-sending-sms-messages-with-dedicated-gsm-modem-device/">troubleshoot</a> page of qualityguru for some common mistakes.</p>
</div>
<div class="section" id="kannel">
<h2>Kannel</h2>
<p>At the moment of writing this post the last stable version is 1.4.3. Using CentOS 6.4 you can install kannel from the epel <a class="reference external" href="http://fedoraproject.org/wiki/EPEL">repository</a>:</p>
<pre class="literal-block">
# yum install kannel
</pre>
<p>Or you can choose to compile it from source:</p>
<pre class="literal-block">
# wget http://www.kannel.org/download/1.4.3/gateway-1.4.3.tar.gz
# tar zxvf gateway-1.4.3.tar.gz -C /usr/local/src/
# cd /usr/local/src/gateway-1.4.3/
# mkdir -p /etc/kannel
# ./configure --prefix=/etc/kannel
# make
# make install
</pre>
<p>I installed the kannel service from the repository and created a symlink from /etc/kannel.conf to the /etc/kannel/kannel.conf so the playsms service could read the configuration afterwards:</p>
<pre class="literal-block">
# mkdir /etc/kannel/
# ln -s /etc/kannel.conf /etc/kannel/kannel.conf
</pre>
<p>Once you configured your device you start kannel by starting the kannel service:</p>
<pre class="literal-block">
# service kannel start
</pre>
<p>If everything went well you can see that there are 2 services started:</p>
<pre class="literal-block">
# ps aux | grep kannel
kannel    9611  1.9  0.1 750424  6684 ?        Sl   13:14   2:37 /usr/sbin/bearerbox /etc/kannel.conf
kannel    9636  0.0  0.1 674228  4676 ?        Sl   13:14   0:00 /usr/sbin/smsbox /etc/kannel.conf
</pre>
<p>In the /var/log/kannel/kannel.log file you can follow the state of the kannel service. I struggled a bit with this to find out the reset string for the modems I used. By searching the internet you can find the particular string for your device.</p>
<p>For example the option one I found on <a class="reference external" href="http://forums.enterprisemobiletoday.com/showthread.php?50854-Getting-Vodafone-s-Option-Globetrotter-to-work">enterprisemobiletoday.com</a> by try &amp; error in the minicom terminal.</p>
<p>I used different sorts of hardware and listed the specific kannel.conf files here under per device.</p>
<p>In the first phase I used a <a class="reference external" href="http://www.business.vodafone.com/site/bus/public/enuk/support/10_productsupport/usb_stick/01_vodafone/02_vodafone_k3565/20_software/p_software.jsp">huawei</a> USB dongle:</p>
<pre class="literal-block">
#CORE
group = core
admin-port = 13000
admin-password = #PASSWORD
status-password = #PASSWORD
log-file = &quot;/var/log/kannel/kannel.log&quot;
log-level = 0
access-log = &quot;/var/log/kannel/access.log&quot;
smsbox-port = 13001
store-type = file
store-location = &quot;/var/log/kannel/kannel.store&quot;*

#SMSC MODEM GSM
group = smsc
smsc = at
connect-allow-ip = 127.0.0.1
port = 13013
host = &quot;localhost&quot;
smsc-id = Huawei
modemtype = Huawei
device = /dev/ttyUSB0
speed = 9600
sms-center = &quot;+32486000005&quot;
my-number = &quot;+324XXXXXXXX&quot;
pin = XXXX

group = modems
id = huawei
name = huawei
detect-string = &quot;huawei&quot;
init-string = &quot;AT+CNMI=2,1,0,0,0;+CMEE=1&quot;

#SMSBOX SETUP
group = smsbox
bearerbox-host = 127.0.0.1
bearerbox-port = 130X01
sendsms-port = 13131
sendsms-chars = &quot;0123456789+&quot;
global-sender = 00324XXXXXXXX
log-file = &quot;/var/log/kannel/smsbox.log&quot;
log-level = 0
access-log = &quot;/var/log/kannel/access.log&quot;

#SEND-SMS USERS
group = sendsms-user
username = #USERNAME
password = #PASSWORD
user-allow-ip = &quot;\*.\*.\*.\*&quot;

#SMS SERVICE
group = sms-service
keyword = default
accept-x-kannel-headers = true
#accepted-smsc = Huawei
accepted-smsc = at2
max-messages = 0
assume-plain-text = true
catch-all = true

get-url = &quot;http://localhost/playsms/index.php?app=call&amp;cat=gateway&amp;plugin=kannel&amp;access=geturl&amp;t=%t&amp;q=%q&amp;a=%a&quot;
</pre>
<p>During the event was in the possession of a <a class="reference external" href="http://www.falcom.de">falcom</a> A2D-1 gateway which was connected from serial to usb:</p>
<pre class="literal-block">
group = core
admin-port = 13000
admin-password = playsms
log-file = &quot;/var/log/kannel/kannel.log&quot;
log-level = 0
access-log = &quot;/var/log/kannel/access.log&quot;
smsbox-port = 13001
store-type = file
store-location = &quot;/var/log/kannel/kannel.store&quot;*

group = smsc
smsc = at
modemtype = falcom
device = /dev/ttyUSB0
my-number = &quot;+324XXXXXXXX&quot;
sms-center = &quot;+32486000005&quot;
pin = XXXX

group = modems
id = falcom
name = &quot;Falcom&quot;
detect-string = &quot;Falcom&quot;
reset-string = &quot;AT+CFUN=1&quot;

#SMSBOX SETUP
group = smsbox
bearerbox-host = localhost
sendsms-port = 13131
log-file = &quot;/var/log/kannel/smsbox.log&quot;
log-level = 0
access-log = &quot;/var/log/kannel/access.log&quot;

#SEND-SMS USERS
group = sendsms-user
username = #USER
password = #PASSWORD

#SMS SERVICE
group = sms-service
keyword = default
accept-x-kannel-headers = true
max-messages = 0
assume-plain-text = true
catch-all = true

get-url = &quot;http://127.0.0.1:2080/playsms/index.php?app=call&amp;cat=gateway&amp;plugin=kannel&amp;access=geturl&amp;t=%t&amp;q=%q&amp;a=%a&quot;
</pre>
<p>After the event I had to give back the falcom and got my hands on an <a class="reference external" href="http://www.option.com/support/globe-trotter-hsdpa">option</a> globetrotter HSPDA card connected on a pcmci slot of the laptop I configured as CentOS server:</p>
<pre class="literal-block">
#CORE
group = core
admin-port = 13000
admin-password = playsms
status-password = playsms
log-file = /var/log/kannel/kannel.log
log-level = 0
access-log = /var/log/kannel/access.log
smsbox-port = 13001
store-type = file
store-location = /var/log/kannel/kannel.store

#SMSC MODEM GSM
group = smsc
smsc = at
connect-allow-ip = 127.0.0.1
port = 13013
host = “localhost”
smsc-id = Option
modemtype = Option
device = /dev/ttyUSB0
speed = 9600
sms-center = &quot;32486000005&quot;
my-number = &quot;324XXXXXXXX&quot;
pin = XXXX

# If modemtype=auto, try everyone and defaults to this one
group = modems
id = generic
name = &quot;Generic Modem&quot;
reset-string = &quot;AT&amp;F&quot;

#SMSBOX SETUP
group = smsbox
bearerbox-host = 127.0.0.1
bearerbox-port = 13001
sendsms-port = 13131
sendsms-chars = “0123456789+”
global-sender = 0032485550261
log-file = “/var/log/kannel/smsbox.log”
log-level = 0
access-log = “/var/log/kannel/access.log”

#SEND-SMS USERS
group = sendsms-user
username = playsms
password = playsms

#SMS SERVICE
group = sms-service
keyword = default
accept-x-kannel-headers = true
accepted-smsc = at
max-messages = 0
assume-plain-text = true
catch-all = true
</pre>
</div>
<div class="section" id="web-service">
<h2>Web service</h2>
<p>For the playsms service we need to have a webserver configured. You can use every webserver you want, I tried with xampp and lighttpd.</p>
<p>During the event I used with the xampp web service because it was working after all by following the howto of <a class="reference external" href="http://kasrut.blogspot.be/2011/07/install-playsms-and-kannel-on-centos-6.html">kasrut</a>.</p>
<p>After the event was finished I migrated to lighttpd mainly because I already had some other applications running on that service.</p>
<p><strong>Xampp</strong></p>
<pre class="literal-block">
# wget http://nchc.dl.sourceforge.net/project/xampp/XAMPP%20Linux/1.7.4/xampp-linux-1.7.4.tar.gz
# tar zxvf xampp-linux-1.7.4.tar.gz -C /opt/
# cd /opt/lampp
# ./lampp start
</pre>
<p><strong>Lighttpd</strong></p>
<p>For the installation of lighttpd I refer to a clear tutorial on <a class="reference external" href="http://www.howtoforge.com/installing-lighttpd-with-php5-php-fpm-and-mysql-support-on-centos-6.3">howtoforge</a></p>
</div>
<div class="section" id="playsms">
<h2>playsms</h2>
<p><a class="reference external" href="http://playsms.org/">playsms</a> is a free and open-source gateway. I used this software to configure a big quiz to set up a cool and trendy communication flow between people and our scouting movement.</p>
<p>I used the <a class="reference external" href="https://github.com/antonraharja/playSMS">git</a> repository to easily update my instance to the newest releases:</p>
<pre class="literal-block">
# cd /usr/local/src/
# git clone git&#64;github.com:antonraharja/playSMS.git
# cd playSMS/
</pre>
<p>Creation of the necessary directories and copy the web files to the webserver directory</p>
<pre class="literal-block">
# mkdir -p /var/www/html/playsms /var/spool/playsms /var/log/playsms /var/lib/playsms
# cp -r usr/local/src/playSMS/web/* /var/www/html/playsms/
</pre>
<p>Creation of a mysql db and user:</p>
<pre class="literal-block">
# mysql -u root -p
# Enter password:


# mysql&gt; create database playsms;
Query OK, 1 row affected (0.00 sec)

# mysql&gt; grant usage on *.* to USER&#64;localhost identified by ‘PASSWORD’;
Query OK, 0 rows affected (0.00 sec)

# mysql&gt; grant all privileges on playsms.* to USER&#64;localhost ;
Query OK, 0 rows affected (0.00 sec)

# mysql&gt; quit

# msql -u root -p playsms &lt; /usr/local/src/playSMS/db/playsms.sql
</pre>
<p>Next step is to configure the playsms web service. Therefore follow those steps:</p>
<pre class="literal-block">
# cd /var/www/html/playsms
# cp config-dist.php config.php
</pre>
<p>Edit this config.php file to your own needs.</p>
<p>Now we configured the parameters we can start to install the services:</p>
<pre class="literal-block">
# mkdir -p /etc/default /usr/local/bin
# cp /usr/local/src/playSMS/daemon/linux/etc/playsms /etc/default/
# cp /usr/local/src/playSMS/daemon/linux/bin/* /usr/local/bin/
# vim /etc/default/playsms # edit the paths to your environment ones
</pre>
<p>I've used rc.local to start the service at boot:</p>
<pre class="literal-block">
# vim /etc/rc.d/rc.local
</pre>
<p>and put /usr/local/bin/playsmsd_start at the end of that file</p>
<p>Next I configured 2 new aliases in my ~/.bashrc to easily start and stop the service:</p>
<pre class="literal-block">
alias playsms-start='/usr/local/bin/playsmsd_start'
alias playsms-stop='/usr/local/bin/playsmsd_stop'
</pre>
<p>By re-logging in you can start the service by:</p>
<pre class="literal-block">
# playsms-start
</pre>
<p>And check if the necessary services are started:</p>
<pre class="literal-block">
# ps aux | grep playsms
root      7735  0.0  0.0 103236   868 pts/4    S+   15:52   0:00 grep playsms
root     21845  0.0  0.0 106312  1660 pts/4    S    12:25   0:06 /bin/bash ./playsmsd /var/www/html/playsms
root     21847  0.0  0.0 106184  1536 pts/4    S    12:25   0:05 /bin/bash ./sendsmsd /var/www/html/playsms
</pre>
<dl class="docutils">
<dt>Finally you can browse <a class="reference external" href="http:/">http:/</a>/&lt;your web server IP&gt;/playsms/ and login using</dt>
<dd>username: admin
password: admin</dd>
</dl>
<p>Where you need to configure kannel in the menu: Gateway &gt; Manage Kannel &gt; kannel (Inactive) (click here to activate) and adopt the parameters to the ones you configured in kannel.conf</p>
<p>After filling in your preferences you should be able to send and receive messages through this nifty web console.</p>
<p>(TIP: Using twice the same keyword for a quiz resulted in the fact that only this word is needed to send to the sms server to start the interactivity)</p>
<p>Have fun with it!</p>
</div>

                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/centos.html">centOS</a>, <a href="https://visibilityspots.github.io/blog/tag/debian.html">debian</a>, <a href="https://visibilityspots.github.io/blog/tag/gsm.html">gsm</a>, <a href="https://visibilityspots.github.io/blog/tag/huawai.html">huawai</a>, <a href="https://visibilityspots.github.io/blog/tag/kannel.html">kannel</a>, <a href="https://visibilityspots.github.io/blog/tag/playsms.html">playsms</a>, <a href="https://visibilityspots.github.io/blog/tag/server.html">server</a>, <a href="https://visibilityspots.github.io/blog/tag/sms.html">sms</a>, <a href="https://visibilityspots.github.io/blog/tag/option.html">option</a>, <a href="https://visibilityspots.github.io/blog/tag/globetrotter.html">globetrotter</a>, <a href="https://visibilityspots.github.io/blog/tag/falcom.html">falcom</a>, <a href="https://visibilityspots.github.io/blog/tag/mobile.html">mobile</a>, <a href="https://visibilityspots.github.io/blog/tag/vikings.html">vikings</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
    </body>
</html>