<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    Traefik SSL grading
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/normalize.css">
        <link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/main.css">

    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/blog.css">
    <link rel="stylesheet" href="https://visibilityspots.github.io/blog/theme/css/github.css">
        <link href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="visibilityspots Atom Feed" />
        <link href="https://visibilityspots.github.io/blog/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="visibilityspots RSS Feed" />
        <script src="https://visibilityspots.github.io/blog/theme/js/vendor/modernizr-2.6.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
    <a id="site-title" href="https://visibilityspots.github.io/blog"><h1>visibilityspots <i class="icon-dashboard"></i></h1></a>
        <p id="site-desc"> Linux & Open-Source enthusiast | Scouting | Longboarding </p>
    </hgroup>

    <nav>
        <ul id="nav-links">
                <li><a href="https://visibilityspots.github.io/blog/">Blog</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/profile.html">Profile</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/projects.html">Projects</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/tools.html">Tools</a></li>
                <li><a href="https://visibilityspots.github.io/blog/pages/contact.html">Contact</a></li>
        </ul>
    </nav>
    Categories:
      <ul>
        <li><a href="https://visibilityspots.github.io/blog/category/android.html">android</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/apple.html">apple</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/automation.html">automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/cloud.html">cloud</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/conferences.html">conferences</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/home-automation.html">home-automation</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/linux.html">linux</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/networking.html">networking</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/other.html">other</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/php.html">php</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/puppet.html">puppet</a></li>
        <li><a href="https://visibilityspots.github.io/blog/category/security.html">security</a></li>
      </ul>
<footer id="site-info">
  <a href="http://creativecommons.org/licenses/by-nc/2.0/be/deed.nl">License</a> | 2009 - 2025 <a href="https://visibilityspots.github.io/blog">visibilityspots.github.io/blog</a> | Generated by <a href="http://getpelican.com/" target="pelican">Pelican</a> | Hosted at <a href="https://pages.github.com/" target="github pages">github pages</a> | <a href="https://visibilityspots.github.io/blog/feeds/all.atom.xml" rel="alternate">Atom</a> feed
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <a href="https://visibilityspots.github.io/blog/traefik-ssl-grading.html" rel="bookmark"><h1>Traefik SSL grading</h1></a>
<div><p>takes 0 minutes to read</p></div>                        <time class="post-time" datetime="2022-08-20T12:00:00+02:00" pubdate>
                            last modified at Thu 25 August 2022
                        </time>
                    </header>
                    <section class="post-content">
                        <p>Recently I discovered that many of the services I deployed upon my <a href="https://visibilityspots.github.io/blog/nomad-arm-cluster.html">nomad cluster</a>  didn't had the SSL A grading I expected them to have. Somehow I asumed the <a href="https://visibilityspots.github.io/blog/traefik-nomad-route53.html">traefik letsencrypt</a> implementation got the A rating by default.</p>
<p>After running the <a href="https://github.com/drwetter/testssl.sh">testssl.sh</a> container it turns out they don't;</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-ti<span class="w"> </span>drwetter/testssl.sh<span class="w"> </span>domain.org
<span class="w"> </span>Rating<span class="w"> </span>specs<span class="w"> </span><span class="o">(</span>not<span class="w"> </span><span class="nb">complete</span><span class="o">)</span><span class="w">  </span>SSL<span class="w"> </span>Labs<span class="s1">&#39;s &#39;</span>SSL<span class="w"> </span>Server<span class="w"> </span>Rating<span class="w"> </span>Guide<span class="err">&#39;</span><span class="w"> </span><span class="o">(</span>version<span class="w"> </span>2009q<span class="w"> </span>from<span class="w"> </span><span class="m">2020</span>-01-30<span class="o">)</span>
<span class="w"> </span>Specification<span class="w"> </span>documentation<span class="w">  </span>https://github.com/ssllabs/research/wiki/SSL-Server-Rating-Guide
<span class="w"> </span>Protocol<span class="w"> </span>Support<span class="w"> </span><span class="o">(</span>weighted<span class="o">)</span><span class="w">  </span><span class="m">95</span><span class="w"> </span><span class="o">(</span><span class="m">28</span><span class="o">)</span>
<span class="w"> </span>Key<span class="w"> </span>Exchange<span class="w">     </span><span class="o">(</span>weighted<span class="o">)</span><span class="w">  </span><span class="m">100</span><span class="w"> </span><span class="o">(</span><span class="m">30</span><span class="o">)</span>
<span class="w"> </span>Cipher<span class="w"> </span>Strength<span class="w">  </span><span class="o">(</span>weighted<span class="o">)</span><span class="w">  </span><span class="m">90</span><span class="w"> </span><span class="o">(</span><span class="m">36</span><span class="o">)</span>
<span class="w"> </span>Final<span class="w"> </span>Score<span class="w">                  </span><span class="m">94</span>
<span class="w"> </span>Overall<span class="w"> </span>Grade<span class="w">                </span>B
<span class="w"> </span>Grade<span class="w"> </span>cap<span class="w"> </span>reasons<span class="w">            </span>Grade<span class="w"> </span>capped<span class="w"> </span>to<span class="w"> </span>B.<span class="w"> </span>TLS<span class="w"> </span><span class="m">1</span>.1<span class="w"> </span>offered
<span class="w">                              </span>Grade<span class="w"> </span>capped<span class="w"> </span>to<span class="w"> </span>B.<span class="w"> </span>TLS<span class="w"> </span><span class="m">1</span>.0<span class="w"> </span>offered
<span class="w">                              </span>Grade<span class="w"> </span>capped<span class="w"> </span>to<span class="w"> </span>A.<span class="w"> </span>HSTS<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>offered
</code></pre></div>

<p>Turns out traefik by default offers TLS 1.0 and 1.1 which are deprecated since 2018. So those needs to be disabled and TLS 1.3 needs to be supported.</p>
<p>So I started looking into the matter to get that A+ rating and found out traefik has some <a href="https://doc.traefik.io/traefik/https/tls/#tls-options">tls options</a> which can be configured to get there. So I configured traefik with those extra configuration parameters.</p>
<div class="highlight"><pre><span></span><code>traefik.toml:

        [tls.options]
            [tls.options.default]
                sniStrict = true
                minVersion = &quot;VersionTLS12&quot;
                curvePreferences = [&quot;CurveP521&quot;, &quot;CurveP384&quot;]
                cipherSuites = [
                    &quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&quot;,
                    &quot;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&quot;,
                    &quot;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&quot;,
                    &quot;TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305&quot;,
                    &quot;TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305&quot;
                ]
            [tls.options.mintls13]
                minVersion = &quot;VersionTLS13&quot;
</code></pre></div>

<p>This already got me towards an A rating. Obviously it  was already a big step towards the aim of the A+ rating hence still not there yet so I digged deeper into the matter and tried to get the missing HSTS headers fixed to get that + rating!</p>
<p>And thanks to the internet, <a href="https://www.simplecto.com/improve-traefik-https-encryption-qualys-ssl-labs-testssl-sh/">simplecto</a> &amp; <a href="https://community.traefik.io/t/setting-hsts-headers/3794">traefik community</a> I found out adding an extra middleware to fix those headers could bring me that extra + rating;</p>
<div class="highlight"><pre><span></span><code>traefik.toml:
        [entryPoints.https.http]
            middlewares = [&quot;securedheaders&quot;]
            tls = &quot;true&quot;
</code></pre></div>

<p>By configuring this middleware through the https entrypoint and since all http traffic is redirected towards the https entrypoint now all the traffic which reaches the traefik proxy instance will get those headers by default;</p>
<div class="highlight"><pre><span></span><code><span class="n">nomad</span><span class="w"> </span><span class="n">traefik</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="n">tags</span><span class="p">;</span>
<span class="w">        </span><span class="s2">&quot;traefik.http.middlewares.securedheaders.headers.forceSTSHeader=true&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;traefik.http.middlewares.securedheaders.headers.STSPreload=true&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;traefik.http.middlewares.securedheaders.headers.ContentTypeNosniff=true&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;traefik.http.middlewares.securedheaders.headers.browserXssFilter=true&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;traefik.http.middlewares.securedheaders.headers.STSIncludeSubdomains=true&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;traefik.http.middlewares.securedheaders.headers.STSSeconds=315360000&quot;</span><span class="p">,</span>
</code></pre></div>

<p>This means that all my traefik configured services get that A+ rating by default from now on!!</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-ti<span class="w"> </span>drwetter/testssl.sh<span class="w"> </span>domain.org
Rating<span class="w"> </span>specs<span class="w"> </span><span class="o">(</span>not<span class="w"> </span><span class="nb">complete</span><span class="o">)</span><span class="w">  </span>SSL<span class="w"> </span>Labs<span class="s1">&#39;s &#39;</span>SSL<span class="w"> </span>Server<span class="w"> </span>Rating<span class="w"> </span>Guide<span class="err">&#39;</span><span class="w"> </span><span class="o">(</span>version<span class="w"> </span>2009q<span class="w"> </span>from<span class="w"> </span><span class="m">2020</span>-01-30<span class="o">)</span>
<span class="w"> </span>Specification<span class="w"> </span>documentation<span class="w">  </span>https://github.com/ssllabs/research/wiki/SSL-Server-Rating-Guide
<span class="w"> </span>Protocol<span class="w"> </span>Support<span class="w"> </span><span class="o">(</span>weighted<span class="o">)</span><span class="w">  </span><span class="m">100</span><span class="w"> </span><span class="o">(</span><span class="m">30</span><span class="o">)</span>
<span class="w"> </span>Key<span class="w"> </span>Exchange<span class="w">     </span><span class="o">(</span>weighted<span class="o">)</span><span class="w">  </span><span class="m">100</span><span class="w"> </span><span class="o">(</span><span class="m">30</span><span class="o">)</span>
<span class="w"> </span>Cipher<span class="w"> </span>Strength<span class="w">  </span><span class="o">(</span>weighted<span class="o">)</span><span class="w">  </span><span class="m">90</span><span class="w"> </span><span class="o">(</span><span class="m">36</span><span class="o">)</span>
<span class="w"> </span>Final<span class="w"> </span>Score<span class="w">                  </span><span class="m">96</span>
<span class="w"> </span>Overall<span class="w"> </span>Grade<span class="w">                </span>A+
</code></pre></div>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="https://visibilityspots.github.io/blog/category/containers.html">containers</a></p>
                        <p>Tags: <a href="https://visibilityspots.github.io/blog/tag/traefik.html">traefik</a>, <a href="https://visibilityspots.github.io/blog/tag/ssl.html">ssl</a>, <a href="https://visibilityspots.github.io/blog/tag/https.html">https</a>, <a href="https://visibilityspots.github.io/blog/tag/grading.html">grading</a>, <a href="https://visibilityspots.github.io/blog/tag/testssl.html">testssl</a>, <a href="https://visibilityspots.github.io/blog/tag/qualys.html">qualys</a>, <a href="https://visibilityspots.github.io/blog/tag/ssllabs.html">ssllabs</a>, <a href="https://visibilityspots.github.io/blog/tag/labs.html">labs</a>, <a href="https://visibilityspots.github.io/blog/tag/a.html">a</a>, <a href="https://visibilityspots.github.io/blog/tag/b.html">b</a>, </p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'visibilityspots';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

        <script src="https://visibilityspots.github.io/blog/theme/js/main.js"></script>
    </body>
</html>